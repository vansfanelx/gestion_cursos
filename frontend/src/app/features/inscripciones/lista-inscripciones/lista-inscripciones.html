<div class="inscripciones-container">
  <header class="page-header">
    <h1>{{ pageTitle }}</h1>
  </header>

  <div class="toolbar">
    <div class="search-box">
      <input
        type="text"
        [(ngModel)]="searchText"
        placeholder="Buscar por estudiante, curso o profesor..."
        class="search-input"
      />
      <span class="search-icon">ğŸ”</span>
    </div>
    <div class="toolbar-actions">
      <select [(ngModel)]="filtroEstado" class="filter-select">
        <option value="todos">Todos los estados</option>
        <option value="inscrito">Inscrito</option>
        <option value="en_progreso">En Progreso</option>
        <option value="completado">Completado</option>
        <option value="abandonado">Abandonado</option>
      </select>
      @if (isAdmin) {
        <button class="btn-add" [routerLink]="'/inscripciones/nuevo'">
          â• Nueva InscripciÃ³n
        </button>
      }
    </div>
  </div>

  @if (loading) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Cargando inscripciones...</p>
    </div>
  } @else if (error) {
    <div class="error-message">
      <p>{{ error }}</p>
      <button (click)="loadInscripciones()">Reintentar</button>
    </div>
  } @else {
    <div class="table-container">
      <table class="inscripciones-table">
        <thead>
          <tr>
            <th>Estudiante</th>
            <th>Curso</th>
            <th>Profesor</th>
            <th>Estado</th>
            <th>Parcial (40%)</th>
            <th>Final (60%)</th>
            <th>Promedio</th>
            <th>Fecha</th>
            <th class="actions-header">Acciones</th>
          </tr>
        </thead>
        <tbody>
          @if (filteredInscripciones.length === 0) {
            <tr>
              <td colspan="9" class="empty-state">
                No se encontraron inscripciones
              </td>
            </tr>
          } @else {
            @for (inscripcion of filteredInscripciones; track inscripcion.id) {
              <tr>
                <td>
                  <div class="user-info">
                    <span class="user-icon">ğŸ‘¤</span>
                    <strong>{{ inscripcion.estudiante?.name || 'Sin nombre' }}</strong>
                  </div>
                </td>
                <td>
                  <div class="curso-info">
                    <span class="curso-icon">ğŸ“š</span>
                    {{ inscripcion.curso?.nombre || 'Sin curso' }}
                  </div>
                </td>
                <td>
                  <div class="profesor-info">
                    <span class="profesor-icon">ğŸ‘¨â€ğŸ«</span>
                    {{ inscripcion.curso?.profesor?.name || 'Sin profesor' }}
                  </div>
                </td>
                <td>
                  <span class="badge" [ngClass]="getEstadoBadgeClass(inscripcion.estado)">
                    {{ getEstadoLabel(inscripcion.estado) }}
                  </span>
                </td>
                <td>
                  @if (inscripcion.nota_parcial !== null && inscripcion.nota_parcial !== undefined) {
                    <span class="nota">{{ inscripcion.nota_parcial }}</span>
                  } @else {
                    <span class="nota-pendiente">Pendiente</span>
                  }
                </td>
                <td>
                  @if (inscripcion.nota_final !== null && inscripcion.nota_final !== undefined) {
                    <span class="nota">{{ inscripcion.nota_final }}</span>
                  } @else {
                    <span class="nota-pendiente">Pendiente</span>
                  }
                </td>
                <td>
                  @if (inscripcion.promedio !== null && inscripcion.promedio !== undefined) {
                    <span class="nota">{{ inscripcion.promedio }}</span>
                  } @else {
                    <span class="nota-pendiente">Pendiente</span>
                  }
                </td>
                <td>{{ inscripcion.fecha_inscripcion | date: 'dd/MM/yyyy' }}</td>
                <td class="actions-cell">
                  <div class="action-buttons">
                    <button class="btn-icon btn-view" (click)="verDetalle(inscripcion.id)" title="Ver detalles">
                      ğŸ‘ï¸
                    </button>
                    <button class="btn-icon btn-edit" (click)="editInscripcion(inscripcion.id)" title="Editar notas">
                      âœï¸
                    </button>
                    @if (isAdmin) {
                      <button class="btn-icon btn-delete" (click)="deleteInscripcion(inscripcion.id)" title="Eliminar">
                        ğŸ—‘ï¸
                      </button>
                    }
                  </div>
                </td>
              </tr>
            }
          }
        </tbody>
      </table>
    </div>
  }
</div>

<app-confirm-modal
  [show]="showDeleteModal"
  [title]="'Eliminar InscripciÃ³n'"
  [message]="'Â¿EstÃ¡s seguro de que deseas eliminar esta inscripciÃ³n?'"
  [confirmText]="'Eliminar'"
  [cancelText]="'Cancelar'"
  [danger]="true"
  (confirmed)="confirmDelete()"
  (cancelled)="cancelDelete()">
</app-confirm-modal>
