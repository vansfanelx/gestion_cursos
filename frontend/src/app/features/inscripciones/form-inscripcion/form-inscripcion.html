<div class="form-container">
  <div class="form-header">
    <h1>{{ isEditMode ? '✏️ Editar Inscripción' : '➕ Nueva Inscripción' }}</h1>
  </div>

  @if (error) {
    <div class="alert-error">
      {{ error }}
    </div>
  }

  <form [formGroup]="inscripcionForm" (ngSubmit)="onSubmit()" class="inscripcion-form">
    <div class="form-grid">
      <div class="form-group">
        <label>Estudiante *</label>
        <app-search-select
          [options]="estudiantes"
          [labelKey]="'name'"
          [valueKey]="'id'"
          [placeholder]="'Buscar estudiante...'"
          [selectedValue]="selectedEstudianteId"           [disabled]="isEditMode"          (selectedChange)="onEstudianteSelected($event)"
        ></app-search-select>
        @if (inscripcionForm.get('estudiante_id')?.invalid && inscripcionForm.get('estudiante_id')?.touched) {
          <span class="error-text">El estudiante es requerido</span>
        }
      </div>

      <div class="form-group">
        <label>Curso *</label>
        <app-search-select
          [options]="cursos"
          [labelKey]="'nombre'"
          [valueKey]="'id'"
          [placeholder]="'Buscar curso...'"
          [selectedValue]="selectedCursoId"           [disabled]="isEditMode"          (selectedChange)="onCursoSelected($event)"
        ></app-search-select>
        @if (inscripcionForm.get('curso_id')?.invalid && inscripcionForm.get('curso_id')?.touched) {
          <span class="error-text">El curso es requerido</span>
        }
      </div>

      <div class="form-group">
        <label>Estado</label>
        <div class="estado-display">
          <span class="badge" [ngClass]="estadoBadgeClass">{{ estadoLabel }}</span>
          <small class="estado-hint">{{ estadoHint }}</small>
        </div>
      </div>

      @if (isEditMode && isAdmin) {
        <div class="form-group form-group-full">
          <label class="checkbox-label">
            <input type="checkbox" [checked]="marcarAbandonado" (change)="toggleAbandonado($event)" />
            <span>Marcar como Abandonado</span>
          </label>
          <small class="hint">Solo usar si el estudiante abandona el curso</small>
        </div>
      }

      <div class="form-group">
        <label for="nota_parcial">Nota Parcial (40%)</label>
        <input 
          type="number" 
          id="nota_parcial" 
          formControlName="nota_parcial"
          class="form-control"
          min="0"
          max="20"
          step="0.5"
          placeholder="0.00"
        />
      </div>

      <div class="form-group">
        <label for="nota_final">Nota Final (60%)</label>
        <input 
          type="number" 
          id="nota_final" 
          formControlName="nota_final"
          class="form-control"
          min="0"
          max="20"
          step="0.5"
          placeholder="0.00"
        />
      </div>

      <div class="form-group">
        <label>Promedio (40/60)</label>
        @if (promedioCalculado !== null) {
          <div class="promedio-box">{{ promedioCalculado }}</div>
        } @else {
          <div class="promedio-box pendiente">Pendiente</div>
        }
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn-cancel" (click)="cancelar()" [disabled]="loading">
        Cancelar
      </button>
      <button type="submit" class="btn-submit" [disabled]="loading">
        @if (loading) {
          <span class="spinner-small"></span>
          Guardando...
        } @else {
          {{ isEditMode ? 'Actualizar' : 'Crear' }} Inscripción
        }
      </button>
    </div>
  </form>
</div>
